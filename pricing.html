<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pricing - OZMCP | Manage 22.167+ MCP Servers on Windows</title>
  <meta name="description" content="Choose your plan - Plus ($10/mo) or Pro ($20/mo). Download now and start managing 22.167+ MCP servers on Windows.">
  <style>
    html { background: #07080f !important; color: #fff !important; }
    body { background: #07080f !important; visibility: hidden; opacity: 0; transition: opacity .3s ease; }
    body.loaded { visibility: visible; opacity: 1; }
    .pricing {
      padding: 0 0 40px !important;
      margin-top: -8px;
    }
    .pricing .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100% !important;
      max-width: none !important;
      margin: 0 auto !important;
    }
    .pricing-content {
      width: min(100%, 680px);
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .pricing-toggle {
      display: flex;
      justify-content: center;
      width: auto;
      margin: 4px 0 10px;
    }
    .section-head {
      text-align: center;
      width: 100%;
      margin-top: 4px;
      margin-bottom: 8px;
    }
    .toggle-container {
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: 4px;
      display: inline-flex;
      gap: 4px;
    }
    .toggle-btn {
      border: none;
      background: transparent;
      color: #c5ceed;
      border-radius: 10px;
      padding: 10px 16px;
      font-weight: 700;
      cursor: pointer;
    }
    .toggle-btn.active { color: #081220; background: linear-gradient(100deg, #a87512, #d4a82f, #f2cc6c); }
    .discount-badge {
      margin-left: 6px;
      font-size: .72rem;
      color: #0d1222;
      background: #f8de87;
      border-radius: 999px;
      padding: 2px 7px;
    }
    .checkout-shell {
      width: min(100%, 860px);
      margin: 0;
    }
    .checkout-layout {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(230px, 280px);
      gap: 9px;
      align-items: stretch;
    }
    .checkout-main {
      min-width: 0;
    }
    .checkout-summary {
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 14px;
      background: linear-gradient(160deg, rgba(14,17,31,.98), rgba(8,10,18,.98));
      padding: 14px 12px;
      display: grid;
      grid-auto-rows: max-content;
      gap: 10px;
    }
    .checkout-summary-head {
      display: grid;
      gap: 2px;
    }
    .checkout-summary-kicker {
      color: #9ca8cf;
      font-size: .74rem;
      letter-spacing: .08em;
      text-transform: uppercase;
      font-weight: 700;
    }
    .checkout-summary-plan {
      color: #f6f9ff;
      font-size: 1.08rem;
      font-weight: 800;
      line-height: 1.2;
    }
    .checkout-summary-price {
      color: #f2cc6c;
      font-size: 1.3rem;
      font-weight: 800;
      line-height: 1.1;
    }
    .checkout-summary-cycle {
      color: #c8d3f5;
      font-size: .9rem;
      margin-top: -4px;
    }
    .checkout-summary-list {
      list-style: none;
      margin: 2px 0 0;
      padding: 0;
      display: grid;
      gap: 7px;
      color: #d6dffc;
      font-size: .84rem;
    }
    .checkout-summary-list li {
      display: flex;
      gap: 9px;
      align-items: flex-start;
    }
    .checkout-summary-list i {
      color: #f2cc6c;
      margin-top: 2px;
    }
    .checkout-summary-footnote {
      color: #9ca8cf;
      font-size: .74rem;
      line-height: 1.35;
      border-top: 1px solid rgba(255,255,255,.08);
      padding-top: 10px;
    }
    #pricingCheckoutMessage {
      display: none;
      margin-top: 2px;
      margin-bottom: 8px;
      color: #f2cc6c;
      font-size: .9rem;
      font-weight: 700;
      text-align: center;
    }
    .paddle-inline-wrap {
      margin-top: 8px;
      border: 1px solid rgba(255,255,255,.16);
      border-radius: 14px;
      background: linear-gradient(160deg, rgba(15,18,31,.95), rgba(9,11,20,.95));
      padding: 8px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      scroll-margin-top: 96px;
    }
    .paddle-inline-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 8px;
    }
    .paddle-inline-title {
      color: #e6ecff;
      font-size: .85rem;
      font-weight: 700;
      letter-spacing: .01em;
    }
    .paddle-close-btn {
      border: 1px solid rgba(255,255,255,.2);
      background: rgba(255,255,255,.06);
      color: #d8e1ff;
      border-radius: 999px;
      font-size: .74rem;
      font-weight: 700;
      padding: 5px 9px;
      cursor: pointer;
    }
    .paddle-close-btn:hover {
      border-color: rgba(242,204,108,.45);
      color: #f4ddb0;
    }
    .paddle-inline-frame {
      width: 100%;
      min-height: 440px;
      border-radius: 10px;
      overflow: hidden;
      background: radial-gradient(circle at 22% 16%, rgba(242,204,108,.14), transparent 52%), #090b15;
    }
    body.checkout-focus-mode .pricing-content {
      width: min(100%, 920px);
    }
    body.checkout-focus-mode .checkout-shell {
      width: min(100%, 920px);
    }
    body.checkout-focus-mode .pricing {
      margin-top: 0 !important;
      padding-top: 14px !important;
    }
    body.checkout-focus-mode .section-head,
    body.checkout-focus-mode .pricing-toggle {
      display: none !important;
    }
    body.checkout-focus-mode .pricing-grid,
    body.checkout-focus-mode .cta-section,
    body.checkout-focus-mode .faq-section {
      display: none !important;
    }
    .pricing .pricing-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 300px));
      justify-content: center;
      align-items: stretch;
      gap: 18px;
      width: min(100%, 618px) !important;
      max-width: 618px !important;
      margin: 0 auto !important;
    }
    .pricing .pricing-card {
      position: relative;
      border-radius: 18px;
      padding: 18px;
      background: linear-gradient(145deg, rgba(0, 0, 0, .92), rgba(13, 17, 23, .88));
      border: 1px solid rgba(255,255,255,.12);
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.45);
      width: 100% !important;
      max-width: 300px !important;
    }
    .card-header { display: grid; gap: 6px; }
    .card-content { display: flex; flex-direction: column; flex: 1; }
    .pricing-card.featured { border: 2px solid #e6b800; transform: translateY(-6px); }
    .popular-badge {
      position: absolute;
      top: -11px;
      left: 16px;
      padding: 6px 10px;
      font-size: .74rem;
      border-radius: 999px;
      background: linear-gradient(100deg, #9a7418, #f2cc6c);
    }
    .plan-name { font-size: 1.2rem; margin-bottom: 8px; }
    .plan-description { color: #a6afcf; margin: 8px 0 16px; font-size: .95rem; }
    .plan-price { display: flex; align-items: baseline; gap: 4px; margin-bottom: 8px; }
    .currency { font-size: 1.2rem; color: #f2e1b2; }
    .price { font-size: 2.3rem; font-weight: 800; letter-spacing: -.02em; }
    .period { color: #f2e1b2; }
    .feature-list { list-style: none; margin: 8px 0 14px; display: grid; gap: 8px; color: #dce5ff; }
    .feature-list li { display: flex; align-items: center; gap: 9px; color: #c9d3f1; font-size: .92rem; }
    .feature-list i { color: #e6b800; }
    .plan-button {
      width: 100%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-top: auto;
      text-decoration: none;
    }
    .plan-button.primary { color: #081220; background: linear-gradient(100deg, #a87512, #d4a82f, #f2cc6c); }
    .cta-section {
      width: 100%;
      margin-top: 32px;
      text-align: center;
      padding: 40px 22px;
      background: linear-gradient(120deg, rgba(168, 117, 18, 0.24), rgba(230, 184, 0, 0.12), rgba(8, 12, 25, 0.9));
      border: 1px solid rgba(212, 168, 47, .25);
      border-radius: 22px;
    }
    .cta-section h3 { margin-bottom: 12px; }
    .cta-section p { color: #d5dcf4; max-width: 52ch; margin: 0 auto 20px; }
    .cta-actions { display: flex; gap: 12px; justify-content: center; }
    @media (max-width: 980px) {
      .pricing-content {
        width: min(100%, 360px);
      }
      body.checkout-focus-mode .pricing-content {
        width: min(100%, 680px);
      }
      .pricing .pricing-grid {
        grid-template-columns: 1fr;
        align-items: center;
        width: 100% !important;
        max-width: 360px;
      }
      .pricing .pricing-card {
        max-width: 100% !important;
      }
      .checkout-shell {
        width: 100%;
        max-width: 360px;
      }
      body.checkout-focus-mode .checkout-shell {
        max-width: 680px;
      }
      .checkout-layout {
        grid-template-columns: 1fr;
      }
      .paddle-inline-head {
        flex-direction: column;
        align-items: flex-start;
      }
      .paddle-inline-frame {
        min-height: 430px;
      }
    }
    @media (max-width: 640px) {
      .plan-button { width: 100%; text-align: center; justify-content: center; }
      .cta-actions { flex-direction: column; }
      .pricing-grid { width: 100%; }
    }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;700;800&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="landing_new.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo">
        <i class="fa-solid fa-cube nav-logo-icon"></i>
        <span>OZMCP</span>
      </div>
      <div class="nav-links nav-links-main">
        <a href="/#features" class="nav-link">Features</a>
        <a href="/#servers" class="nav-link">Servers</a>
        <a href="/#ides" class="nav-link">IDE Support</a>
        <a href="pricing.html" class="nav-link active">Pricing</a>
        <a href="/#faq" class="nav-link">FAQ</a>
      </div>
      <div class="nav-cta">
        <a id="authSignIn" class="auth-btn" href="/dashboard">Sign In</a>
        <button id="authSignOut" class="auth-btn" type="button" style="display:none;">Sign Out</button>
        <a id="authProfile" class="profile-avatar" href="javascript:void(0)" aria-label="Profile">?</a>
        <a href="https://github.com/mcpmarket/mcpmarket/releases" class="btn-primary" target="_blank">
          <i class="fa-solid fa-download"></i> Download
        </a>
      </div>
    </div>
  </nav>

  <section class="section pricing">
    <div class="container">
      <div class="pricing-content">
        <div class="section-head">
          <h2>Choose Your Plan</h2>
        </div>

        <div class="pricing-toggle">
          <div class="toggle-container">
            <button class="toggle-btn active" data-period="monthly">Monthly</button>
            <button class="toggle-btn" data-period="yearly">Yearly <span class="discount-badge" id="savingsBadge">Save 17%</span></button>
          </div>
        </div>
        <div class="checkout-shell">
          <div id="pricingCheckoutMessage"></div>
          <div id="paddleInlineWrap" class="paddle-inline-wrap" hidden>
            <div class="checkout-layout">
              <div class="checkout-main">
                <div class="paddle-inline-head">
                  <div class="paddle-inline-title">Complete your purchase</div>
                  <button id="closeInlineCheckout" type="button" class="paddle-close-btn">Close</button>
                </div>
                <div id="paddleInlineFrame" class="paddle-inline-frame paddle-checkout-frame"></div>
              </div>
              <aside class="checkout-summary">
                <div class="checkout-summary-head">
                  <div class="checkout-summary-kicker">Selected Plan</div>
                  <div id="checkoutSummaryPlan" class="checkout-summary-plan">Plus</div>
                  <div id="checkoutSummaryPrice" class="checkout-summary-price">$10</div>
                  <div id="checkoutSummaryCycle" class="checkout-summary-cycle">Billed monthly</div>
                </div>
                <ul class="checkout-summary-list">
                  <li><i class="fa-solid fa-circle-check"></i><span>Instant activation after payment</span></li>
                  <li><i class="fa-solid fa-circle-check"></i><span>Secure checkout with Card or PayPal</span></li>
                  <li><i class="fa-solid fa-circle-check"></i><span>Cancel anytime from your account</span></li>
                </ul>
                <div class="checkout-summary-footnote">
                  Purchase mode keeps the page focused so the checkout fits cleanly on screen.
                </div>
              </aside>
            </div>
          </div>
        </div>

        <div class="pricing-grid">
          <!-- Plus Plan -->
          <article class="pricing-card featured">
            <div class="popular-badge">Most Popular</div>
            <div class="card-header">
              <div class="plan-name">Plus</div>
              <div class="plan-description">For individual developers</div>
              <div class="plan-price monthly-price">
                <span class="currency">$</span>
                <span class="price" id="plusMonthlyPrice">10</span>
                <span class="period">/month</span>
              </div>
              <div class="plan-price yearly-price" style="display: none;">
                <span class="currency">$</span>
                <span class="price" id="plusYearlyPrice">100</span>
                <span class="period">/year</span>
              </div>
            </div>
            <div class="card-content">
              <ul class="feature-list">
                <li><i class="fa-solid fa-check"></i> Install 22.167+ MCP servers</li>
                <li><i class="fa-solid fa-check"></i> All 8 IDEs supported</li>
                <li><i class="fa-solid fa-check"></i> Auto-configuration</li>
                <li><i class="fa-solid fa-check"></i> Priority support</li>
                <li><i class="fa-solid fa-check"></i> Windows installer & portable</li>
              </ul>
              <button type="button" class="plan-button primary js-paddle-checkout" data-plan="plus">
                Get Plus
              </button>
            </div>
          </article>

          <!-- Pro Plan -->
          <article class="pricing-card">
            <div class="card-header">
              <div class="plan-name">Pro</div>
              <div class="plan-description">For power users and teams</div>
              <div class="plan-price monthly-price">
                <span class="currency">$</span>
                <span class="price" id="proMonthlyPrice">20</span>
                <span class="period">/month</span>
              </div>
              <div class="plan-price yearly-price" style="display: none;">
                <span class="currency">$</span>
                <span class="price" id="proYearlyPrice">160</span>
                <span class="period">/year</span>
              </div>
            </div>
            <div class="card-content">
              <ul class="feature-list">
                <li><i class="fa-solid fa-check"></i> Everything in Plus</li>
                <li><i class="fa-solid fa-check"></i> Team deployment tools</li>
                <li><i class="fa-solid fa-check"></i> Dedicated support</li>
                <li><i class="fa-solid fa-check"></i> Custom integrations</li>
              </ul>
              <button type="button" class="plan-button js-paddle-checkout" data-plan="pro">
                Get Pro
              </button>
            </div>
          </article>
        </div>
      </div>

      <div class="cta-section">
        <h3>Choose the Perfect Plan for You</h3>
        <p>Start with Plus and upgrade to Pro when you need more advanced features. No commitment required.</p>
        <div class="cta-actions">
          <a href="https://github.com/mcpmarket/mcpmarket/releases" class="btn-primary" target="_blank">
            <i class="fa-solid fa-download"></i> Download Now
          </a>
        </div>
      </div>
    </div>
  </section>

  <section class="section faq-section">
    <div class="container">
      <div class="section-head">
        <h2>Frequently Asked Questions</h2>
      </div>
      <div class="faq-grid">
        <div class="faq-item">
          <h4>Which plan should I choose?</h4>
          <p>Plus is perfect for individual developers. Pro is ideal for teams and users who need advanced features like bulk management and custom integrations.</p>
        </div>
        <div class="faq-item">
          <h4>Can I change plans later?</h4>
          <p>Yes! You can upgrade or downgrade your plan at any time. Prorated billing will be applied automatically.</p>
        </div>
        <div class="faq-item">
          <h4>Do I need to create an account?</h4>
          <p>No account required. Just download, install, and start managing your MCP servers immediately.</p>
        </div>
        <div class="faq-item">
          <h4>What IDEs are supported?</h4>
          <p>MCPMarket supports Cursor, VS Code, Windsurf, Claude Code, Zed, Continue, Cline, and Kilo Code.</p>
        </div>
        <div class="faq-item">
          <h4>How do I get updates?</h4>
          <p>Updates are available through GitHub releases. MCPMarket will notify you when new versions are available.</p>
        </div>
        <div class="faq-item">
          <h4>Is there a free trial?</h4>
          <p>Yes! Start with a 14-day free trial to experience all Plus features before committing to a subscription.</p>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-logo">
          <div class="logo-icon-small">M</div>
          <span>MCPMarket</span>
        </div>
        <div class="footer-links">
          <a href="index.html">Home</a>
          <a href="pricing.html" class="active">Pricing</a>
          <a href="https://github.com/mcpmarket/mcpmarket" target="_blank">GitHub</a>
          <a href="https://github.com/mcpmarket/mcpmarket/issues" target="_blank">Support</a>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2026 MCPMarket. Built with Electron + Next.js for Windows.</p>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.paddle.com/paddle/v2/paddle.js"></script>
  <script src="auth.js?v=20260301-6"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      document.body.classList.add('loaded');

      const SUPABASE_URL = 'https://yvnymvyfzpxjxiuadmat.supabase.co';
      const SUPABASE_PUBLISHABLE_KEY = 'sb_publishable_Ut9Brq0lHzA_bqtiqTCvYw_mncnnuFT';
      const supabaseClient = window.supabase ? window.supabase.createClient(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY) : null;

      const monthlyBtn = document.querySelector('[data-period="monthly"]');
      const yearlyBtn = document.querySelector('[data-period="yearly"]');
      const monthlyPrices = document.querySelectorAll('.monthly-price');
      const yearlyPrices = document.querySelectorAll('.yearly-price');
      const savingsBadgeEl = document.getElementById('savingsBadge');
      const checkoutMessageEl = document.getElementById('pricingCheckoutMessage');
      const paddleInlineWrapEl = document.getElementById('paddleInlineWrap');
      const paddleInlineFrameEl = document.getElementById('paddleInlineFrame');
      const closeInlineCheckoutEl = document.getElementById('closeInlineCheckout');
      const plusMonthlyPriceEl = document.getElementById('plusMonthlyPrice');
      const plusYearlyPriceEl = document.getElementById('plusYearlyPrice');
      const proMonthlyPriceEl = document.getElementById('proMonthlyPrice');
      const proYearlyPriceEl = document.getElementById('proYearlyPrice');
      const checkoutSummaryPlanEl = document.getElementById('checkoutSummaryPlan');
      const checkoutSummaryPriceEl = document.getElementById('checkoutSummaryPrice');
      const checkoutSummaryCycleEl = document.getElementById('checkoutSummaryCycle');
      let currentCheckoutPlan = 'plus';
      let currentCheckoutPeriod = 'monthly';

      const showCheckoutMessage = (message, isError) => {
        if (!checkoutMessageEl) return;
        checkoutMessageEl.textContent = message || '';
        checkoutMessageEl.style.display = message ? 'block' : 'none';
        checkoutMessageEl.style.color = isError ? '#fca5a5' : '#f2cc6c';
      };

      const paddleClientToken = 'test_5806d829bb2fda4370368edd0d9';
      const priceMap = {
        plus: {
          monthly: 'pri_01kjn0sx3n847qx2c5a4nvp6y8',
          yearly: 'pri_01kjn0wbygzkf46evjrv1q2zwk'
        },
        pro: {
          monthly: 'pri_01kjn10jparpmg9b30x8x0e6n2',
          yearly: 'pri_01kjn12w70f8pqg4hga2n2qvw1'
        }
      };
      const displayedAmounts = {
        plus: { monthly: 10, yearly: 100 },
        pro: { monthly: 20, yearly: 160 }
      };

      const setPeriod = (period) => {
        const isYearly = period === 'yearly';
        monthlyBtn.classList.toggle('active', !isYearly);
        yearlyBtn.classList.toggle('active', isYearly);
        monthlyPrices.forEach((price) => {
          price.style.display = isYearly ? 'none' : 'flex';
        });
        yearlyPrices.forEach((price) => {
          price.style.display = isYearly ? 'flex' : 'none';
        });
      };

      const updateSavingsBadge = () => {
        if (!savingsBadgeEl) return;
        const monthly = Number(displayedAmounts.plus.monthly);
        const yearly = Number(displayedAmounts.plus.yearly);
        if (!monthly || !yearly) return;
        const yearlyEquivalent = monthly * 12;
        const discountPercent = Math.max(0, Math.round(((yearlyEquivalent - yearly) / yearlyEquivalent) * 100));
        savingsBadgeEl.textContent = `Save ${discountPercent}%`;
      };

      const setDisplayedPrice = (plan, period, amount) => {
        const normalizedAmount = Number(amount);
        if (!Number.isFinite(normalizedAmount) || normalizedAmount <= 0) return;
        displayedAmounts[plan][period] = normalizedAmount;
        const priceText = Number.isInteger(normalizedAmount) ? String(normalizedAmount) : normalizedAmount.toFixed(2);
        if (plan === 'plus' && period === 'monthly' && plusMonthlyPriceEl) plusMonthlyPriceEl.textContent = priceText;
        if (plan === 'plus' && period === 'yearly' && plusYearlyPriceEl) plusYearlyPriceEl.textContent = priceText;
        if (plan === 'pro' && period === 'monthly' && proMonthlyPriceEl) proMonthlyPriceEl.textContent = priceText;
        if (plan === 'pro' && period === 'yearly' && proYearlyPriceEl) proYearlyPriceEl.textContent = priceText;
      };

      const setCheckoutFocusMode = (enabled) => {
        document.body.classList.toggle('checkout-focus-mode', Boolean(enabled));
      };

      const updateCheckoutSummary = (plan, period) => {
        const normalizedPlan = plan === 'pro' ? 'pro' : 'plus';
        const normalizedPeriod = period === 'yearly' ? 'yearly' : 'monthly';
        const amount = displayedAmounts?.[normalizedPlan]?.[normalizedPeriod];
        const planLabel = normalizedPlan === 'pro' ? 'Pro' : 'Plus';
        const cycleLabel = normalizedPeriod === 'yearly' ? 'Billed yearly' : 'Billed monthly';
        const priceLabel = Number.isFinite(Number(amount))
          ? `$${Number.isInteger(Number(amount)) ? String(Number(amount)) : Number(amount).toFixed(2)}`
          : '';

        currentCheckoutPlan = normalizedPlan;
        currentCheckoutPeriod = normalizedPeriod;
        if (checkoutSummaryPlanEl) checkoutSummaryPlanEl.textContent = planLabel;
        if (checkoutSummaryPriceEl) checkoutSummaryPriceEl.textContent = priceLabel;
        if (checkoutSummaryCycleEl) checkoutSummaryCycleEl.textContent = cycleLabel;
      };

      const isVerifiedSession = (session) => {
        const confirmedAt = session?.user?.email_confirmed_at || session?.user?.confirmed_at;
        return Boolean(session && confirmedAt);
      };

      const getVerifiedSession = async () => {
        if (!supabaseClient) return null;
        const result = await supabaseClient.auth.getSession();
        const session = result?.data?.session || null;
        return isVerifiedSession(session) ? session : null;
      };

      const goToAuthForCheckout = (plan, period) => {
        const nextPath = `/pricing?resumeCheckout=1&plan=${encodeURIComponent(plan)}&period=${encodeURIComponent(period)}`;
        window.location.href = `/dashboard?next=${encodeURIComponent(nextPath)}`;
      };

      const hideInlineCheckout = () => {
        if (!paddleInlineWrapEl) return;
        paddleInlineWrapEl.hidden = true;
        if (paddleInlineFrameEl) paddleInlineFrameEl.innerHTML = '';
        setCheckoutFocusMode(false);
      };

      const showInlineCheckout = () => {
        if (!paddleInlineWrapEl) return false;
        paddleInlineWrapEl.hidden = false;
        setCheckoutFocusMode(true);
        paddleInlineWrapEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
        return true;
      };

      const syncPricesFromPaddle = async () => {
        if (!window.Paddle) return;
        const plans = ['plus', 'pro'];
        const periods = ['monthly', 'yearly'];
        for (const plan of plans) {
          for (const period of periods) {
            const priceId = priceMap?.[plan]?.[period];
            if (!priceId) continue;
            try {
              const preview = await window.Paddle.PricePreview({
                items: [{ priceId, quantity: 1 }]
              });
              const lineItem = preview?.data?.details?.lineItems?.[0];
              const amountCents = Number(lineItem?.price?.unitPrice?.amount);
              if (Number.isFinite(amountCents) && amountCents > 0) {
                setDisplayedPrice(plan, period, amountCents / 100);
              }
            } catch (_) {
              // Keep fallback prices if preview fails.
            }
          }
        }
        updateSavingsBadge();
      };

      const openCheckoutFor = (plan, period, verifiedSession) => {
        if (!window.Paddle) {
          showCheckoutMessage('Paddle failed to load. Please refresh the page and try again.', true);
          return;
        }
        const priceId = priceMap?.[plan]?.[period];
        if (!priceId) {
          showCheckoutMessage('Plan/price information not found.', true);
          return;
        }
        updateCheckoutSummary(plan, period);
        showCheckoutMessage('', false);
        const user = verifiedSession?.user || {};
        const customData = {
          supabase_user_id: user.id || '',
          supabase_email: user.email || '',
          plan_tier: plan
        };
        const useInlineCheckout = showInlineCheckout();
        const checkoutSettings = useInlineCheckout
          ? {
              displayMode: 'inline',
              frameTarget: 'paddle-checkout-frame',
              frameInitialHeight: '540',
              frameStyle: 'width: 100%; min-width: 280px; background-color: transparent; border: none;',
              variant: 'one-page',
              theme: 'dark',
              locale: 'en'
            }
          : {
              displayMode: 'overlay',
              variant: 'one-page',
              theme: 'dark',
              locale: 'en'
            };
        try {
          Paddle.Checkout.open({
            items: [{ priceId: priceId, quantity: 1 }],
            customer: user.email ? { email: user.email } : undefined,
            customData,
            settings: checkoutSettings
          });
        } catch (_) {
          showCheckoutMessage('Checkout could not be opened. Please refresh and try again.', true);
        }
      };

      if (window.Paddle) {
        if (paddleClientToken.startsWith('test_')) {
          Paddle.Environment.set('sandbox');
        }
        Paddle.Initialize({
          token: paddleClientToken,
          eventCallback: function(event) {
            if (event?.name === 'checkout.completed') {
              showCheckoutMessage('Payment completed successfully. Thank you!', false);
              hideInlineCheckout();
            }
            if (event?.name === 'checkout.closed') {
              hideInlineCheckout();
            }
          }
        });
        syncPricesFromPaddle();
      }

      const checkoutButtons = document.querySelectorAll('.js-paddle-checkout');
      checkoutButtons.forEach((button) => {
        button.addEventListener('click', async function () {
          const selectedPeriodBtn = document.querySelector('.toggle-btn.active');
          const period = selectedPeriodBtn?.dataset?.period === 'yearly' ? 'yearly' : 'monthly';
          const plan = String(button.dataset.plan || '').toLowerCase() === 'pro' ? 'pro' : 'plus';

          const verifiedSession = await getVerifiedSession();
          if (!verifiedSession) {
            showCheckoutMessage('Please sign in or sign up to purchase. Redirecting...', false);
            goToAuthForCheckout(plan, period);
            return;
          }
          openCheckoutFor(plan, period, verifiedSession);
        });
      });

      monthlyBtn.addEventListener('click', function () {
        setPeriod('monthly');
        if (!paddleInlineWrapEl?.hidden) updateCheckoutSummary(currentCheckoutPlan, 'monthly');
      });
      yearlyBtn.addEventListener('click', function () {
        setPeriod('yearly');
        if (!paddleInlineWrapEl?.hidden) updateCheckoutSummary(currentCheckoutPlan, 'yearly');
      });
      if (closeInlineCheckoutEl) {
        closeInlineCheckoutEl.addEventListener('click', function () {
          if (window.Paddle?.Checkout?.close) window.Paddle.Checkout.close();
          hideInlineCheckout();
        });
      }

      setPeriod('monthly');
      updateSavingsBadge();

      const params = new URLSearchParams(window.location.search);
      const resumeCheckout = params.get('resumeCheckout') === '1';
      const resumePlan = String(params.get('plan') || 'plus').toLowerCase() === 'pro' ? 'pro' : 'plus';
      const resumePeriod = params.get('period') === 'yearly' ? 'yearly' : 'monthly';

      if (resumePeriod === 'yearly') setPeriod('yearly');
      if (resumeCheckout) {
        getVerifiedSession().then((verifiedSession) => {
          if (!verifiedSession) return;
          showCheckoutMessage('Sign-in successful. Opening checkout...', false);
          openCheckoutFor(resumePlan, resumePeriod, verifiedSession);
          params.delete('resumeCheckout');
          params.delete('plan');
          params.delete('period');
          const nextQuery = params.toString();
          const nextUrl = nextQuery ? `${window.location.pathname}?${nextQuery}` : window.location.pathname;
          window.history.replaceState({}, '', nextUrl);
        });
      }

      // Smooth scroll for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });
    });
  </script>
</body>
</html>

